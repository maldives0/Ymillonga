{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport React, { useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport AppLayout from '../../components/AppLayout';\nimport PostForm from '../../components/PostForm';\nimport PostCard from '../../components/PostCard';\nimport UserProfile from '../../components/UserProfile';\nimport { LOAD_RELATED_POSTS_REQUEST } from '../../reducers/post';\nimport { LOAD_MY_INFO_REQUEST } from '../../reducers/user';\nimport wrapper from '../../store/configureStore';\nimport { END } from 'redux-saga';\nimport axios from 'axios';\nimport Link from 'next/link';\nimport { message, Button } from 'antd';\nimport { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst Home = () => {\n  const dispatch = useDispatch();\n  const id = useSelector(state => {\n    var _state$user$me;\n\n    return (_state$user$me = state.user.me) === null || _state$user$me === void 0 ? void 0 : _state$user$me.id;\n  });\n  const mainPosts = useSelector(state => state.post.mainPosts);\n  const hasMorePosts = useSelector(state => state.post.hasMorePosts);\n  const loadPostsLoading = useSelector(state => state.post.loadPostsLoading);\n  const loadPostsDone = useSelector(state => state.post.loadPostsDone);\n  const reportPostDone = useSelector(state => state.post.reportPostDone);\n  const reportPostError = useSelector(state => state.post.reportPostError);\n  const retweetError = useSelector(state => state.post.retweetError);\n  const me = useSelector(state => state.user.me);\n  useEffect(() => {\n    if (reportPostDone) {\n      message.success('신고가 접수되었습니다. 빠른 시일 내로 조치하겠습니다.', 5);\n    }\n\n    if (reportPostError) {\n      message.error(reportPostError, 5);\n    }\n  }, [reportPostDone, reportPostError]);\n  useEffect(() => {\n    if (retweetError) {\n      alert(retweetError);\n    }\n  }, [retweetError]);\n  useEffect(() => {\n    function onScroll() {\n      if (window.scrollY + document.documentElement.clientHeight > document.documentElement.scrollHeight - 300) {\n        if (hasMorePosts && !loadPostsLoading) {\n          var _mainPosts;\n\n          const lastId = (_mainPosts = mainPosts[mainPosts.length - 1]) === null || _mainPosts === void 0 ? void 0 : _mainPosts.id;\n          dispatch({\n            type: LOAD_RELATED_POSTS_REQUEST,\n            lastId\n          });\n        }\n      }\n    }\n\n    window.addEventListener('scroll', onScroll);\n    return () => {\n      //쌓여있는 이벤트 메모리를 제거해주기\n      window.removeEventListener('scroll', onScroll);\n    };\n  }, [mainPosts, hasMorePosts, loadPostsLoading]);\n  return ___EmotionJSX(AppLayout, null, me && me.id && ___EmotionJSX(Button, null, ___EmotionJSX(Link, {\n    href: \"/\"\n  }, ___EmotionJSX(\"a\", null, \"\\uC804\\uCCB4 \\uAC8C\\uC2DC\\uAE00 \\uBCF4\\uAE30\"))), me && me.id && ___EmotionJSX(UserProfile, null), me && ___EmotionJSX(PostForm, null), mainPosts === null || mainPosts === void 0 ? void 0 : mainPosts.map(post => {\n    return ___EmotionJSX(PostCard, {\n      key: post.id,\n      post: post\n    });\n  }));\n};\n\nexport const getServerSideProps = wrapper.getServerSideProps(async context => {\n  //redux는 next 서버 메소드 4개와 쓸 때 문제가 있어서 wrapper-redux를 사용하기//Component보다 먼저 실행된다(FE에서만 실행된다 FE-> BE, Home component는 BS와 FE 둘다에서 실행된다 )\n  console.log('getServerSideProps start'); // bs=>be는 bs로부터 axios에 cookie에 자동으로 담겨 be로 보내진다\n  //fe=>be로 보낼 때는 따로 설정을 해주어야 한다\n\n  const cookie = context.req ? context.req.headers.cookie : ''; //서버일 때만 쿠키값을 담아서\n\n  axios.defaults.headers.Cookie = ''; //다른 bs에서 요청을 보내면 fe server에 공유되고 있는 쿠키값을 지워야 한다\n\n  if (context.req && cookie) {\n    axios.defaults.headers.Cookie = cookie;\n  }\n\n  context.store.dispatch({\n    type: LOAD_MY_INFO_REQUEST\n  });\n  context.store.dispatch({\n    type: LOAD_RELATED_POSTS_REQUEST\n  }); //리덕스에 데이터가 채워진 상태로 component가 렌더링된다\n\n  context.store.dispatch(END); //미리 준비된 액션인 END를 가져와서 \n\n  await context.store.sagaTask.toPromise(); //store.sagaTask를 사용해 success해서 데이터를 가져올 때까지 기다리도록 한다\n}); //초기값=>getServerSideProps=> hydrate실행=> payload안에 결과가 담김\n//getStaticProps는 미리 만들어진 HTML를 가져온다(바뀌지 않는 게시글 같은 것을 불러올 때 쓴다)\n//getServerSideProps는 방문할 때마다 불러온다\n\nexport default Home;","map":null,"metadata":{},"sourceType":"module"}